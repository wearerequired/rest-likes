(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var r=e.n(t);const s=window.wp.a11y,o=window.wp.i18n;let n,i,a;try{a=(new Date).getTime().toString(),(n=window.localStorage).setItem(a,a),i=n.getItem(a)!==a,n.removeItem(a),i&&(n=!1)}catch(e){}const c=window.RestLikesApi={},d=e=>{if(n){const t=n.getItem(`rest-likes-${e}`);if(t)return JSON.parse(t)}return[]},l=(e,t)=>-1!==d(e).indexOf(parseInt(t,10)),u=e=>{const t=e.getAttribute("data-type"),r=window.restLikes.object_types[t],s=r.classnames;if(e.classList.contains(s.liked))return;const o=e.getAttribute("data-id");l(t,o)&&(e.classList.add(s.liked),e.querySelector(`.${s.label}`).innerHTML=r.texts.unlike)},p=(e,t,r,s)=>{const n=e.querySelector("[aria-hidden]"),i=e.querySelector(".screen-reader-text");n&&i&&(n.textContent=r,i.textContent=1===t?s:(0,o.sprintf)(s,r),e.setAttribute("data-likes",t))};c.request=(e,t,r)=>{const s=window.restLikes.object_types[e];return window.fetch(window.restLikes.root+s.endpoint.replace("%s",t),{method:r?"DELETE":"POST",headers:window.restLikes.nonce&&{"X-WP-Nonce":window.restLikes.nonce},credentials:"include"})},c.buttonClickHandler=(e,t)=>{const r=document.querySelectorAll(`[data-rest-like-button][data-type="${e}"][data-id="${t}"]`),i=window.restLikes.object_types[e],a=i.classnames;r.forEach((e=>{e.classList.add(a.processing)}));const u=l(e,t);c.request(e,t,u).then((e=>{if(window.Response&&e instanceof Response){if(!e.ok)throw Error(e.statusText);return e.json()}if("object"==typeof e)return e;throw Error("Unknown response")})).then((c=>{if(r.forEach((e=>{e.classList.remove(a.processing);const t=e.querySelector(`.${a.count}`);p(t,c.count,c.countFormatted,c.screenReaderText)})),u)return((e,t)=>{if(n){let r=d(e);r=r.filter((e=>e!==parseInt(t,10))),r=[...new Set(r)],n.setItem(`rest-likes-${e}`,JSON.stringify(r))}})(e,t),r.forEach((e=>{e.classList.remove(a.liked),e.querySelector(`.${a.label}`).innerHTML=i.texts.like})),(0,s.speak)((0,o.sprintf)(r[0].dataset.speakUnlike,c.count)),void document.dispatchEvent(new CustomEvent("restLikes",{detail:{action:"unlike",count:c.count,countFormatted:c.countFormatted,screenReaderText:c.screenReaderText,objectType:e,objectId:t}}));u||(((e,t)=>{if(n){let r=d(e);r&&(r.push(parseInt(t,10)),r=[...new Set(r)],n.setItem(`rest-likes-${e}`,JSON.stringify(r)))}})(e,t),r.forEach((e=>{e.classList.add(a.liked),e.querySelector(`.${a.label}`).innerHTML=i.texts.unlike})),(0,s.speak)((0,o.sprintf)(r[0].dataset.speakLike,c.count)),document.dispatchEvent(new CustomEvent("restLikes",{detail:{action:"like",count:c.count,countFormatted:c.countFormatted,screenReaderText:c.screenReaderText,objectType:e,objectId:t}})))})).catch((n=>{r.forEach((e=>{e.classList.remove(a.processing)})),console.error(n),(0,s.speak)((0,o.__)("There was an error processing your request.","rest-likes")),document.dispatchEvent(new CustomEvent("restLikes",{detail:{action:"error",objectType:e,objectId:t}}))}))};const k=r()(document);k.on("heartbeat-send",((e,t)=>{t.rest_likes={},Object.keys(window.restLikes.object_types).forEach((e=>{const r=document.querySelectorAll(`[data-rest-like-button][data-type="${e}"]`),s=[];r.forEach((e=>{s.push(e.getAttribute("data-id"))})),t.rest_likes[e]=[...new Set(s)]}))})),k.on("heartbeat-tick",((e,t)=>{if(t.rest_likes)for(const e of t.rest_likes){const{objectType:t,objectId:r,count:s,countFormatted:o,screenReaderText:n}=e,i=window.restLikes.object_types[t].classnames;document.querySelectorAll(`[data-rest-like-button][data-type="${t}"][data-id="${r}"]`).forEach((e=>{const t=e.querySelector(`.${i.count}`);p(t,s,o,n)}))}}));const w=e=>{e.forEach((e=>{"attributes"===e.type&&e.target.closest("[data-rest-like-button]")?u(e.target):"childList"===e.type&&e.addedNodes.length&&e.addedNodes.forEach((e=>{if("function"!=typeof e.querySelectorAll)return;const t=e.querySelectorAll("[data-rest-like-button]");t.length&&t.forEach((e=>u(e)))}))}))};document.dispatchEvent(new CustomEvent("restLikes.initialized",{detail:{api:c}})),document.querySelectorAll("[data-rest-like-button]").forEach((e=>u(e))),void 0!==window.MutationObserver&&new window.MutationObserver(w).observe(document.body,{childList:!0,subtree:!0,attributes:!0}),document.body.addEventListener("click",(e=>{const t=e.target.closest("[data-rest-like-button]");t&&c.buttonClickHandler(t.getAttribute("data-type"),t.getAttribute("data-id"),t)}))})();